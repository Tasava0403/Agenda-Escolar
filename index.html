<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de tareas</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

  <div class="container mt-4">

    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-3">
      <h1 class="m-0">Agenda Escolar</h1>

      <!-- Botón abre modal para registrar -->
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalTarea">
        + Nueva tarea
      </button>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">

        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-3">
          <h2 class="h5 m-0">Lista de tareas</h2>

          <!-- mini buscador opcional (solo visual) -->
          <input id="buscador" type="text" class="form-control form-control-sm" style="max-width: 280px;"
            placeholder="Buscar (materia o tarea)">
        </div>

        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th>Materia</th>
                <th>Tarea</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th class="text-nowrap">Acción</th>
              </tr>
            </thead>

            <!-- EL SCRIPT RELLENA AQUÍ -->
            <tbody id="tablaTareasBody"></tbody>
          </table>
        </div>

        <!-- Mensaje cuando no hay tareas -->
        <div id="sinTareas" class="text-center text-muted py-4 d-none">
          No hay tareas registradas todavía. Presiona <strong>+ Nueva tarea</strong>.
        </div>

      </div>
    </div>
  </div>

  <!-- MODAL: VER DETALLE -->
  <div class="modal fade" id="modalVer" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Detalle de la tarea</h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <p class="mb-1"><strong>Materia:</strong> <span id="verMateria"></span></p>
          <p class="mb-1"><strong>Tarea:</strong> <span id="verTarea"></span></p>
          <p class="mb-1"><strong>Fecha:</strong> <span id="verFecha"></span></p>
          <p class="mb-0"><strong>Estado:</strong> <span id="verEstado"></span></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>

      </div>
    </div>
  </div>

  <!-- MODAL: REGISTRAR TAREA (FORMULARIO) -->
  <div class="modal fade" id="modalTarea" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Registrar tarea</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <form id="formTarea">

            <div class="mb-3">
              <label class="form-label">Materia</label>
              <input id="inpMateria" type="text" class="form-control" placeholder="Ej. Matemáticas" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Tarea</label>
              <input id="inpTarea" type="text" class="form-control" placeholder="Ej. Ejercicios pág 20" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha</label>
              <input id="inpFecha" type="date" class="form-control" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Estado</label>
              <select id="inpEstado" class="form-select">
                <option value="Pendiente">Pendiente</option>
                <option value="Hecho">Hecho</option>
              </select>
            </div>

            <button type="submit" class="btn btn-success w-100">
              Guardar tarea
            </button>

          </form>
        </div>

      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS de la app -->
  <script>
    const STORAGE_KEY = "tareasAgenda";

    // === Datos iniciales (solo si no hay nada guardado) ===
    const tareasDemo = [
      { materia: "Matemáticas", tarea: "Ejercicios pág 20", fecha: "10 feb", estado: "Pendiente" },
      { materia: "Inglés", tarea: "Reading", fecha: "12 feb", estado: "Hecho" },
    ];

    function cargarTareas() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }

    function guardarTareas(tareas) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tareas));
    }

    function badgeEstado(estado) {
      return estado === "Hecho"
        ? '<span class="badge text-bg-success">Hecho</span>'
        : '<span class="badge text-bg-warning">Pendiente</span>';
    }

    function mostrarSinTareas(visible) {
      document.getElementById("sinTareas").classList.toggle("d-none", !visible);
    }

    function renderTabla(filtro = "") {
      const tbody = document.getElementById("tablaTareasBody");
      const tareas = cargarTareas();

      const filtroLower = filtro.trim().toLowerCase();
      const tareasFiltradas = tareas.filter(t =>
        (t.materia + " " + t.tarea).toLowerCase().includes(filtroLower)
      );

      tbody.innerHTML = tareasFiltradas.map((t, i) => `
        <tr>
          <td>${t.materia}</td>
          <td>${t.tarea}</td>
          <td>${t.fecha}</td>
          <td>${badgeEstado(t.estado)}</td>
          <td class="text-nowrap">
            <button class="btn btn-primary btn-sm btn-ver"
              data-index="${i}"
              data-bs-toggle="modal"
              data-bs-target="#modalVer">
              Ver
            </button>

            <button class="btn btn-danger btn-sm ms-2 btn-borrar" data-index="${i}">
              Borrar
            </button>
          </td>
        </tr>
      `).join("");

      mostrarSinTareas(tareas.length === 0);

      // Eventos "Ver"
      document.querySelectorAll(".btn-ver").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = Number(btn.getAttribute("data-index"));
          const tarea = cargarTareas()[idx];

          document.getElementById("verMateria").textContent = tarea.materia;
          document.getElementById("verTarea").textContent = tarea.tarea;
          document.getElementById("verFecha").textContent = tarea.fecha;
          document.getElementById("verEstado").textContent = tarea.estado;
        });
      });

      // Eventos "Borrar"
      document.querySelectorAll(".btn-borrar").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = Number(btn.getAttribute("data-index"));
          const tareas = cargarTareas();
          tareas.splice(idx, 1);
          guardarTareas(tareas);
          renderTabla(document.getElementById("buscador").value);
        });
      });
    }

    function formatearFecha(fechaRaw) {
      const d = new Date(fechaRaw + "T00:00:00");
      const meses = ["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"];
      return `${d.getDate()} ${meses[d.getMonth()]}`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Si no hay nada guardado, mete demo una sola vez
      const actuales = cargarTareas();
      if (actuales.length === 0) {
        guardarTareas(tareasDemo);
      }

      renderTabla();

      // Buscador
      document.getElementById("buscador").addEventListener("input", (e) => {
        renderTabla(e.target.value);
      });

      // Guardar desde formulario del modal
      const form = document.getElementById("formTarea");
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const materia = document.getElementById("inpMateria").value.trim();
        const tarea = document.getElementById("inpTarea").value.trim();
        const fechaRaw = document.getElementById("inpFecha").value;
        const estado = document.getElementById("inpEstado").value;

        if (!materia || !tarea || !fechaRaw) return;

        const fecha = formatearFecha(fechaRaw);

        const tareas = cargarTareas();
        tareas.push({ materia, tarea, fecha, estado });
        guardarTareas(tareas);

        form.reset();
        renderTabla(document.getElementById("buscador").value);

        // Cerrar modal
        const modal = bootstrap.Modal.getInstance(document.getElementById("modalTarea"));
        modal.hide();
      });
    });
  </script>

</body>
</html>