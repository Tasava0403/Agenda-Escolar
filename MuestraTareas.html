<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de tareas</title>
  <link rel="icon" type="image/png" href="calendario.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="dise침os.css">
</head>

<body>

  <main class="main-card">
    <div id="menu-container"></div>
    <button class="btn-home" data-bs-toggle="modal"  data-bs-target="#modalMenu">
      游
    </button>

    <!-- Encabezado -->
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-4">
        
      <h1 class="edit-title m-0">Agenda Escolar</h1>

      <!-- Bot칩n nueva tarea -->
      <button class="btn-modify px-4" onclick="window.location.href='registroTareas.html'">
        + Nueva tarea
      </button>
    </div>

      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-3">
        <h2 class="h5 m-0">Lista de tareas</h2>

        <input id="buscador" type="text"
          class="form-control form-control-sm edit-input"
          style="max-width: 280px;"
          placeholder="Buscar (materia o tarea)">
      </div>

      <div class="table-responsive">
        <table class="table text-center align-middle">
          <thead>
            <tr>
              <th>Materia</th>
              <th>Tarea</th>
              <th>Fecha</th>
              <th>Estado</th>
              <th class="text-nowrap">Acci칩n</th>
            </tr>
          </thead>

          <tbody id="tablaTareasBody"></tbody>
        </table>
      </div>

      <!-- Sin tareas -->
      <div id="sinTareas" class="text-center text-muted py-4 d-none">
        No hay tareas registradas todav칤a. Presiona <strong>+ Nueva tarea</strong>.
      </div>

  </main>

  <!-- MODAL VER -->
  <div class="modal fade" id="modalVer" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Detalle de la tarea</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <p><strong>Materia:</strong> <span id="verMateria"></span></p>
          <p><strong>Tarea:</strong> <span id="verTarea"></span></p>
          <p><strong>Fecha:</strong> <span id="verFecha"></span></p>
          <p class="mb-0"><strong>Estado:</strong> <span id="verEstado"></span></p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>

      </div>
    </div>
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS original sin cambios -->
  <script>
    const STORAGE_KEY = "tareasAgenda";

    const tareasDemo = [
      { materia: "Matem치ticas", tarea: "Ejercicios p치g 20", fecha: "10 feb", estado: "Pendiente" },
      { materia: "Ingl칠s", tarea: "Reading", fecha: "12 feb", estado: "Hecho" },
    ];

    function cargarTareas() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }

    function guardarTareas(tareas) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tareas));
    }

    function badgeEstado(estado) {
      return estado === "Hecho"
        ? '<span class="badge text-bg-success">Hecho</span>'
        : '<span class="badge text-bg-warning">Pendiente</span>';
    }

    function mostrarSinTareas(visible) {
      document.getElementById("sinTareas").classList.toggle("d-none", !visible);
    }

    function renderTabla(filtro = "") {
      const tbody = document.getElementById("tablaTareasBody");
      const tareas = cargarTareas();

      const filtroLower = filtro.trim().toLowerCase();
      const tareasFiltradas = tareas.filter(t =>
        (t.materia + " " + t.tarea).toLowerCase().includes(filtroLower)
      );

      tbody.innerHTML = tareasFiltradas.map((t, i) => `
        <tr>
          <td>${t.materia}</td>
          <td>${t.tarea}</td>
          <td>${t.fecha}</td>
          <td>${badgeEstado(t.estado)}</td>
          <td class="text-nowrap">
            <button class="btn btn-primary btn-sm btn-ver"
              data-index="${i}"
              data-bs-toggle="modal"
              data-bs-target="#modalVer">
              Ver
            </button>

            <button class="btn btn-danger btn-sm ms-2 btn-borrar" data-index="${i}">
              Borrar
            </button>
          </td>
        </tr>
      `).join("");

      mostrarSinTareas(tareas.length === 0);

      document.querySelectorAll(".btn-ver").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = Number(btn.getAttribute("data-index"));
          const tarea = cargarTareas()[idx];

          verMateria.textContent = tarea.materia;
          verTarea.textContent = tarea.tarea;
          verFecha.textContent = tarea.fecha;
          verEstado.textContent = tarea.estado;
        });
      });

      document.querySelectorAll(".btn-borrar").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = Number(btn.getAttribute("data-index"));
          const tareas = cargarTareas();
          tareas.splice(idx, 1);
          guardarTareas(tareas);
          renderTabla(document.getElementById("buscador").value);
        });
      });
    }

    function formatearFecha(fechaRaw) {
      const d = new Date(fechaRaw + "T00:00:00");
      const meses = ["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"];
      return `${d.getDate()} ${meses[d.getMonth()]}`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const actuales = cargarTareas();
      if (actuales.length === 0) guardarTareas(tareasDemo);

      renderTabla();

      buscador.addEventListener("input", e => renderTabla(e.target.value));

      formTarea.addEventListener("submit", e => {
        e.preventDefault();

        const materia = inpMateria.value.trim();
        const tarea = inpTarea.value.trim();
        const fechaRaw = inpFecha.value;
        const estado = inpEstado.value;

        if (!materia || !tarea || !fechaRaw) return;

        const fecha = formatearFecha(fechaRaw);

        const tareas = cargarTareas();
        tareas.push({ materia, tarea, fecha, estado });
        guardarTareas(tareas);

        formTarea.reset();
        renderTabla(buscador.value);

        bootstrap.Modal.getInstance(modalTarea).hide();
      });
    });

    fetch("menuModal.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("menu-container").innerHTML = html;
    });
  </script>

</body>
</html>
